{
  "info": {
    "name": "üöÄ FintechPSP - Trilha Completa",
    "description": "Collection completa para testar todo o sistema FintechPSP com JWT Mortadela.\n\nüìã **TRILHA DE TESTES - SIGA ESTA ORDEM:**\n\n**FASE 1 - AUTENTICA√á√ÉO**\n1Ô∏è‚É£ Login Admin (obter token)\n2Ô∏è‚É£ Validar Token JWT\n\n**FASE 2 - GEST√ÉO DE USU√ÅRIOS**\n3Ô∏è‚É£ Criar Cliente\n4Ô∏è‚É£ Listar Clientes\n5Ô∏è‚É£ Buscar Cliente por ID\n6Ô∏è‚É£ Atualizar Cliente\n\n**FASE 3 - GEST√ÉO DE CONTAS**\n7Ô∏è‚É£ Criar Conta Banc√°ria\n8Ô∏è‚É£ Listar Contas\n9Ô∏è‚É£ Consultar Saldo\n\n**FASE 4 - TRANSA√á√ïES**\nüîü Criar Transa√ß√£o PIX\n1Ô∏è‚É£1Ô∏è‚É£ Consultar Transa√ß√£o\n1Ô∏è‚É£2Ô∏è‚É£ Listar Transa√ß√µes\n\n**FASE 5 - WEBHOOKS & INTEGRA√á√ïES**\n1Ô∏è‚É£3Ô∏è‚É£ Configurar Webhook\n1Ô∏è‚É£4Ô∏è‚É£ Testar Integra√ß√£o\n\n**CONFIGURA√á√ÉO:**\n- Base URL: http://localhost:5000\n- JWT: Mortadela (Issuer/Audience)\n- Credenciais Admin: admin@fintechpsp.com / admin123",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": {
      "major": 2,
      "minor": 1,
      "patch": 0
    }
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000",
      "type": "string",
      "description": "URL base do API Gateway"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string",
      "description": "Token JWT obtido no login"
    },
    {
      "key": "client_id",
      "value": "",
      "type": "string",
      "description": "ID do cliente criado"
    },
    {
      "key": "account_id",
      "value": "",
      "type": "string",
      "description": "ID da conta banc√°ria criada"
    },
    {
      "key": "transaction_id",
      "value": "",
      "type": "string",
      "description": "ID da transa√ß√£o criada"
    }
  ],
  "item": [
    {
      "name": "üìã FASE 1 - AUTENTICA√á√ÉO",
      "description": "Endpoints para autentica√ß√£o e valida√ß√£o de tokens JWT",
      "item": [
        {
          "name": "1Ô∏è‚É£ Login Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salvar token automaticamente",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', response.accessToken);",
                  "    console.log('‚úÖ Token salvo automaticamente');",
                  "    ",
                  "    // Decodificar JWT para verificar",
                  "    const token = response.accessToken;",
                  "    const payload = JSON.parse(atob(token.split('.')[1]));",
                  "    console.log('üîç Token JWT:', payload);",
                  "    console.log('üìù Issuer:', payload.iss);",
                  "    console.log('üìù Audience:', payload.aud);",
                  "    ",
                  "    pm.test('Token cont√©m Issuer Mortadela', () => {",
                  "        pm.expect(payload.iss).to.equal('Mortadela');",
                  "    });",
                  "    ",
                  "    pm.test('Token cont√©m Audience Mortadela', () => {",
                  "        pm.expect(payload.aud).to.equal('Mortadela');",
                  "    });",
                  "} else {",
                  "    console.log('‚ùå Erro no login');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@fintechpsp.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Fazer login como administrador e obter token JWT com Mortadela"
          }
        },
        {
          "name": "2Ô∏è‚É£ Validar Token JWT (REMOVIDO - rota n√£o existe)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Token v√°lido', () => {",
                  "    pm.expect(pm.response.text()).to.include('valid');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth/validate",
              "host": ["{{base_url}}"],
              "path": ["auth", "validate"]
            },
            "description": "Validar se o token JWT est√° funcionando corretamente"
          }
        }
      ]
    },
    {
      "name": "üë• FASE 2 - GEST√ÉO DE USU√ÅRIOS",
      "description": "Endpoints para gerenciar clientes do sistema",
      "item": [
        {
          "name": "3Ô∏è‚É£ Criar Cliente",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('client_id', response.id);",
                  "    console.log('‚úÖ Cliente criado com ID:', response.id);",
                  "    ",
                  "    pm.test('Cliente criado com sucesso', () => {",
                  "        pm.expect(response.id).to.not.be.empty;",
                  "        pm.expect(response.name).to.equal('Joao Silva Teste');",
                  "        pm.expect(response.email).to.equal('joao.teste@email.com');",
                  "        pm.expect(response.active).to.be.true;",
                  "    });",
                  "} else {",
                  "    console.log('‚ùå Erro ao criar cliente');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Joao Silva Teste\",\n  \"email\": \"joao.teste@email.com\",\n  \"document\": \"12345678901\",\n  \"phone\": \"11999887766\",\n  \"address\": \"Rua das Flores, 123 - S√£o Paulo/SP\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/client-users",
              "host": ["{{base_url}}"],
              "path": ["client-users"]
            },
            "description": "Criar um novo cliente no sistema"
          }
        },
        {
          "name": "4Ô∏è‚É£ Listar Clientes",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Lista de clientes retornada', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.be.an('array');",
                  "    console.log('üìã Total de clientes:', response.length);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/client-users",
              "host": ["{{base_url}}"],
              "path": ["client-users"]
            },
            "description": "Listar todos os clientes cadastrados"
          }
        },
        {
          "name": "5Ô∏è‚É£ Buscar Cliente por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Cliente encontrado', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.id).to.equal(pm.collectionVariables.get('client_id'));",
                  "    console.log('‚úÖ Cliente encontrado:', response.name);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/client-users/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["client-users", "{{client_id}}"]
            },
            "description": "Buscar cliente espec√≠fico por ID"
          }
        },
        {
          "name": "6Ô∏è‚É£ Atualizar Cliente",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Cliente atualizado', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.name).to.equal('Jo√£o Silva Atualizado');",
                  "    console.log('‚úÖ Cliente atualizado com sucesso');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Joao Silva Atualizado\",\n  \"phone\": \"11888777666\",\n  \"address\": \"Rua Nova, 456 - S√£o Paulo/SP\",\n  \"active\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/client-users/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["client-users", "{{client_id}}"]
            },
            "description": "Atualizar dados do cliente"
          }
        }
      ]
    },
    {
      "name": "üè¶ FASE 3 - GEST√ÉO DE CONTAS",
      "description": "Endpoints para gerenciar contas banc√°rias e saldos",
      "item": [
        {
          "name": "7Ô∏è‚É£ Criar Conta Banc√°ria",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('account_id', response.contaId || response.id);",
                  "    console.log('‚úÖ Conta criada com ID:', response.contaId || response.id);",
                  "    ",
                  "    pm.test('Conta criada com sucesso', () => {",
                  "        pm.expect(response.contaId || response.id).to.not.be.empty;",
                  "        pm.expect(response.conta || response.accountNumber).to.not.be.empty;",
                  "        pm.expect(response.banco || response.bankCode).to.not.be.empty;",
                  "    });",
                  "} else {",
                  "    console.log('‚ùå Erro ao criar conta:', pm.response.text());",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ClienteId\": \"{{client_id}}\",\n  \"BankCode\": \"001\",\n  \"AccountNumber\": \"12345-6\",\n  \"Description\": \"Conta Corrente Principal\",\n  \"Credentials\": {\n    \"ClientId\": \"test_client_id\",\n    \"ClientSecret\": \"test_client_secret\",\n    \"ApiKey\": \"test_api_key\",\n    \"Environment\": \"sandbox\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/accounts",
              "host": ["{{base_url}}"],
              "path": ["accounts"]
            },
            "description": "Criar nova conta banc√°ria para o cliente"
          }
        },
        {
          "name": "8Ô∏è‚É£ Listar Contas",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Lista de contas retornada', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.be.an('array');",
                  "    console.log('üè¶ Total de contas:', response.length);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/accounts",
              "host": ["{{base_url}}"],
              "path": ["accounts"]
            },
            "description": "Listar todas as contas banc√°rias"
          }
        },
        {
          "name": "9Ô∏è‚É£ Consultar Saldo",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Saldo retornado', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.balance).to.be.a('number');",
                  "    console.log('üí∞ Saldo atual: R$', response.balance);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/saldo/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["saldo", "{{client_id}}"]
            },
            "description": "Consultar saldo da conta banc√°ria"
          }
        }
      ]
    },
    {
      "name": "üí∏ FASE 4 - TRANSA√á√ïES",
      "description": "Endpoints para processar transa√ß√µes PIX, TED e outras",
      "item": [
        {
          "name": "üîü Criar Transa√ß√£o PIX",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('transaction_id', response.id);",
                  "    console.log('‚úÖ Transa√ß√£o PIX criada com ID:', response.id);",
                  "    ",
                  "    pm.test('Transa√ß√£o PIX criada', () => {",
                  "        pm.expect(response.id).to.not.be.empty;",
                  "        pm.expect(response.type).to.equal('PIX');",
                  "        pm.expect(response.amount).to.equal(100.50);",
                  "        pm.expect(response.status).to.equal('PENDING');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fromAccountId\": \"{{account_id}}\",\n  \"toPixKey\": \"11999887766\",\n  \"amount\": 100.50,\n  \"description\": \"Pagamento teste PIX\",\n  \"type\": \"PIX\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transactions",
              "host": ["{{base_url}}"],
              "path": ["transactions"]
            },
            "description": "Criar uma nova transa√ß√£o PIX"
          }
        },
        {
          "name": "1Ô∏è‚É£1Ô∏è‚É£ Consultar Transa√ß√£o",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Transa√ß√£o encontrada', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.id).to.equal(pm.collectionVariables.get('transaction_id'));",
                  "    console.log('‚úÖ Transa√ß√£o encontrada:', response.type, 'R$', response.amount);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/transactions/{{transaction_id}}",
              "host": ["{{base_url}}"],
              "path": ["transactions", "{{transaction_id}}"]
            },
            "description": "Consultar status de uma transa√ß√£o espec√≠fica"
          }
        },
        {
          "name": "1Ô∏è‚É£2Ô∏è‚É£ Listar Transa√ß√µes",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Lista de transa√ß√µes retornada', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.be.an('array');",
                  "    console.log('üí∏ Total de transa√ß√µes:', response.length);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/transactions?contaId={{account_id}}",
              "host": ["{{base_url}}"],
              "path": ["transactions"],
              "query": [
                {
                  "key": "contaId",
                  "value": "{{account_id}}"
                }
              ]
            },
            "description": "Listar todas as transa√ß√µes de uma conta"
          }
        }
      ]
    },
    {
      "name": "üîó FASE 5 - WEBHOOKS & INTEGRA√á√ïES",
      "description": "Endpoints para configurar webhooks e testar integra√ß√µes",
      "item": [
        {
          "name": "1Ô∏è‚É£3Ô∏è‚É£ Configurar Webhook",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201 Created', () => {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Webhook configurado', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.url).to.include('webhook.site');",
                  "    pm.expect(response.events).to.include('transaction.completed');",
                  "    console.log('‚úÖ Webhook configurado para:', response.url);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"url\": \"https://webhook.site/unique-id\",\n  \"events\": [\n    \"transaction.completed\",\n    \"transaction.failed\",\n    \"account.balance.updated\"\n  ],\n  \"active\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks",
              "host": ["{{base_url}}"],
              "path": ["webhooks"]
            },
            "description": "Configurar webhook para receber notifica√ß√µes de eventos"
          }
        },
        {
          "name": "1Ô∏è‚É£4Ô∏è‚É£ Testar Integra√ß√£o",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200 OK', () => {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Integra√ß√£o funcionando', () => {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.status).to.equal('healthy');",
                  "    console.log('‚úÖ Integra√ß√£o funcionando:', response.message);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/integrations/health",
              "host": ["{{base_url}}"],
              "path": ["integrations", "health"]
            },
            "description": "Testar se as integra√ß√µes est√£o funcionando corretamente"
          }
        }
      ]
    },
    {
      "name": "üõ†Ô∏è UTILIT√ÅRIOS",
      "description": "Endpoints auxiliares para testes e debugging",
      "item": [
        {
          "name": "üîç Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Verificar se o API Gateway est√° funcionando"
          }
        },
        {
          "name": "üìä Status dos Servi√ßos",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/status",
              "host": ["{{base_url}}"],
              "path": ["status"]
            },
            "description": "Verificar status de todos os microservi√ßos"
          }
        }
      ]
    }
  ]
}
