{
  "info": {
    "name": "FintechPSP Microservices",
    "description": "Collection para testar APIs do PSP event-driven",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://localhost:7001",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "AuthService",
      "item": [
        {
          "name": "Obter Token OAuth 2.0",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', response.access_token);",
                  "    pm.test('Token obtido com sucesso', function () {",
                  "        pm.expect(response.access_token).to.not.be.empty;",
                  "        pm.expect(response.token_type).to.eql('Bearer');",
                  "        pm.expect(response.expires_in).to.be.a('number');",
                  "    });",
                  "} else {",
                  "    pm.test('Erro na autenticação', function () {",
                  "        pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"grant_type\": \"client_credentials\",\n  \"client_id\": \"fintech_web_app\",\n  \"client_secret\": \"web_app_secret_123\",\n  \"scope\": \"pix banking\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/token",
              "host": ["{{base_url}}"],
              "path": ["auth", "token"]
            }
          }
        },
        {
          "name": "Health Check AuthService",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/auth/health",
              "host": ["{{base_url}}"],
              "path": ["auth", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "TransactionService",
      "item": [
        {
          "name": "Iniciar Transação PIX",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"pix-{{$randomUUID}}\",\n  \"amount\": 100.50,\n  \"pixKey\": \"11999887766\",\n  \"bankCode\": \"341\",\n  \"description\": \"Pagamento teste PIX\",\n  \"webhookUrl\": \"https://webhook.site/unique-id\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix"]
            }
          }
        },
        {
          "name": "Iniciar Transação TED",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"ted-{{$randomUUID}}\",\n  \"amount\": 500.00,\n  \"bankCode\": \"001\",\n  \"accountBranch\": \"1234\",\n  \"accountNumber\": \"567890\",\n  \"taxId\": \"12345678901\",\n  \"name\": \"João da Silva\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/ted",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "ted"]
            }
          }
        },
        {
          "name": "Emitir Boleto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"boleto-{{$randomUUID}}\",\n  \"amount\": 250.75,\n  \"dueDate\": \"2025-10-15T23:59:59Z\",\n  \"payerTaxId\": \"12345678901\",\n  \"payerName\": \"Maria Santos\",\n  \"instructions\": \"Pagamento referente a serviços prestados\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/boleto",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "boleto"]
            }
          }
        },
        {
          "name": "Iniciar Transação Cripto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"cripto-{{$randomUUID}}\",\n  \"amount\": 1000.00,\n  \"cryptoType\": \"USDT\",\n  \"walletAddress\": \"0x742d35Cc6634C0532925a3b8D4C9db96DfB3f681\",\n  \"fiatCurrency\": \"BRL\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/cripto",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "cripto"]
            }
          }
        }
      ]
    },
    {
      "name": "BalanceService",
      "item": [
        {
          "name": "Consultar Saldo",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/clientes/{{$randomUUID}}/saldo",
              "host": ["{{base_url}}"],
              "path": ["clientes", "{{$randomUUID}}", "saldo"]
            }
          }
        }
      ]
    },
    {
      "name": "WebhookService",
      "item": [
        {
          "name": "Registrar Webhook",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"url\": \"https://webhook.site/unique-id\",\n  \"events\": [\"PIX_CONFIRMED\", \"BOLETO_PAID\", \"TED_CONFIRMED\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks",
              "host": ["{{base_url}}"],
              "path": ["webhooks"]
            }
          }
        },
        {
          "name": "Webhook Incoming (Simulação)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"PIX_CONFIRMED\",\n  \"transactionId\": \"{{$randomUUID}}\",\n  \"endToEndId\": \"E12345678202509161234567890\",\n  \"status\": \"CONFIRMED\",\n  \"amount\": 100.50,\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks/incoming",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "incoming"]
            }
          }
        }
      ]
    },
    {
      "name": "Admin APIs",
      "item": [
        {
          "name": "Criar Usuário",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{$randomUUID}}\",\n  \"email\": \"usuario@exemplo.com\",\n  \"role\": \"cliente\",\n  \"accountId\": \"{{$randomUUID}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/users",
              "host": ["{{base_url}}"],
              "path": ["admin", "users"]
            }
          }
        },
        {
          "name": "Configurar Taxa",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bankCode\": \"341\",\n  \"taxa\": 1.99,\n  \"type\": \"PIX\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/configs/taxas",
              "host": ["{{base_url}}"],
              "path": ["admin", "configs", "taxas"]
            }
          }
        },
        {
          "name": "Listar Taxas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/admin/configs/taxas",
              "host": ["{{base_url}}"],
              "path": ["admin", "configs", "taxas"]
            }
          }
        }
      ]
    },
    {
      "name": "QR Code PIX",
      "item": [
        {
          "name": "Gerar QR Code Estático",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code estático gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.qrcodePayload).to.not.be.empty;",
                  "    pm.expect(response.qrcodeImage).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('static');",
                  "    pm.expect(response.expiresAt).to.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"QR-STATIC-{{$randomUUID}}\",\n  \"pixKey\": \"11999887766\",\n  \"bankCode\": \"001\",\n  \"description\": \"QR Code estático para recebimentos\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix/qrcode/estatico",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix", "qrcode", "estatico"]
            }
          }
        },
        {
          "name": "Gerar QR Code Dinâmico",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code dinâmico gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.qrcodePayload).to.not.be.empty;",
                  "    pm.expect(response.qrcodeImage).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('dynamic');",
                  "    pm.expect(response.amount).to.be.a('number');",
                  "    pm.expect(response.expiresAt).to.not.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"QR-DYNAMIC-{{$randomUUID}}\",\n  \"amount\": 150.00,\n  \"pixKey\": \"usuario@email.com\",\n  \"bankCode\": \"237\",\n  \"description\": \"Pagamento de produto XYZ\",\n  \"expiresIn\": 300\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix/qrcode/dinamico",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix", "qrcode", "dinamico"]
            }
          }
        },
        {
          "name": "Gerar QR Code Estático (Banking)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code estático banking gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('static');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"QR-BANKING-{{$randomUUID}}\",\n  \"pixKey\": \"12345678901\",\n  \"bankCode\": \"341\",\n  \"description\": \"QR Code para internet banking\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/banking/transacoes/pix/qrcode/estatico",
              "host": ["{{base_url}}"],
              "path": ["banking", "transacoes", "pix", "qrcode", "estatico"]
            }
          }
        },
        {
          "name": "Health Check QR Code",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/qrcode/health",
              "host": ["{{base_url}}"],
              "path": ["qrcode", "health"]
            }
          }
        }
      ]
    }
  ]
}
