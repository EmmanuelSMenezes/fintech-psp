{
  "info": {
    "name": "FintechPSP Microservices",
    "description": "Collection para testar APIs do PSP event-driven",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "admin_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "cliente_id",
      "value": "123e4567-e89b-12d3-a456-426614174000",
      "type": "string"
    },
    {
      "key": "conta_stark_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "conta_efi_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "conta_sicoob_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "AuthService",
      "item": [
        {
          "name": "Obter Token OAuth 2.0",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', response.access_token);",
                  "    pm.test('Token obtido com sucesso', function () {",
                  "        pm.expect(response.access_token).to.not.be.empty;",
                  "        pm.expect(response.token_type).to.eql('Bearer');",
                  "        pm.expect(response.expires_in).to.be.a('number');",
                  "    });",
                  "} else {",
                  "    pm.test('Erro na autenticação', function () {",
                  "        pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"grant_type\": \"client_credentials\",\n  \"client_id\": \"integration_test\",\n  \"client_secret\": \"test_secret_000\",\n  \"scope\": \"pix banking\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/token",
              "host": ["{{base_url}}"],
              "path": ["auth", "token"]
            }
          }
        },
        {
          "name": "Health Check AuthService",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/auth/health",
              "host": ["{{base_url}}"],
              "path": ["auth", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "UserService - Account Management",
      "item": [
        {
          "name": "Banking - Listar Contas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/banking/contas",
              "host": ["{{base_url}}"],
              "path": ["banking", "contas"]
            }
          }
        },
        {
          "name": "Banking - Criar Conta Efí",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bankCode\": \"EFI\",\n  \"accountNumber\": \"12345-6\",\n  \"description\": \"Conta Principal Efí\",\n  \"credentials\": {\n    \"clientId\": \"Client_Id_efi_001\",\n    \"clientSecret\": \"Client_Secret_efi_001\",\n    \"additionalData\": {\n      \"environment\": \"sandbox\",\n      \"version\": \"v1\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/banking/contas",
              "host": ["{{base_url}}"],
              "path": ["banking", "contas"]
            }
          }
        },
        {
          "name": "Admin - Criar Conta Stark para Cliente",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clienteId\": \"{{cliente_id}}\",\n  \"bankCode\": \"STARK\",\n  \"accountNumber\": \"98765-4\",\n  \"description\": \"Conta Stark Bank - Admin Created\",\n  \"credentials\": {\n    \"clientId\": \"Client_Id_stark_admin\",\n    \"clientSecret\": \"Client_Secret_stark_admin\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/contas",
              "host": ["{{base_url}}"],
              "path": ["admin", "contas"]
            }
          }
        }
      ]
    },
    {
      "name": "ConfigService - Prioritization",
      "item": [
        {
          "name": "Banking - Obter Configuração de Roteamento",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/banking/configs/roteamento",
              "host": ["{{base_url}}"],
              "path": ["banking", "configs", "roteamento"]
            }
          }
        },
        {
          "name": "Banking - Configurar Priorização (50% Stark, 20% Efí)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"prioridades\": [\n    {\n      \"contaId\": \"{{conta_stark_id}}\",\n      \"percentual\": 50.0\n    },\n    {\n      \"contaId\": \"{{conta_efi_id}}\",\n      \"percentual\": 20.0\n    },\n    {\n      \"contaId\": \"{{conta_sicoob_id}}\",\n      \"percentual\": 30.0\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/banking/configs/roteamento",
              "host": ["{{base_url}}"],
              "path": ["banking", "configs", "roteamento"]
            }
          }
        },
        {
          "name": "Banking - Listar Bancos Disponíveis",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/banking/bancos",
              "host": ["{{base_url}}"],
              "path": ["banking", "bancos"]
            }
          }
        }
      ]
    },
    {
      "name": "TransactionService",
      "item": [
        {
          "name": "Iniciar Transação PIX",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"pix-{{$randomUUID}}\",\n  \"amount\": 100.50,\n  \"pixKey\": \"11999887766\",\n  \"bankCode\": \"341\",\n  \"description\": \"Pagamento teste PIX\",\n  \"webhookUrl\": \"https://webhook.site/unique-id\",\n  \"contaId\": \"{{conta_stark_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix"]
            }
          }
        },
        {
          "name": "Iniciar Transação TED",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"ted-{{$randomUUID}}\",\n  \"amount\": 500.00,\n  \"bankCode\": \"001\",\n  \"accountBranch\": \"1234\",\n  \"accountNumber\": \"567890\",\n  \"taxId\": \"12345678901\",\n  \"name\": \"João da Silva\",\n  \"contaId\": \"{{conta_efi_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/ted",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "ted"]
            }
          }
        },
        {
          "name": "Emitir Boleto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"boleto-{{$randomUUID}}\",\n  \"amount\": 250.75,\n  \"dueDate\": \"2025-10-15T23:59:59Z\",\n  \"payerTaxId\": \"12345678901\",\n  \"payerName\": \"Maria Santos\",\n  \"instructions\": \"Pagamento referente a serviços prestados\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/boleto",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "boleto"]
            }
          }
        },
        {
          "name": "Iniciar Transação Cripto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"externalId\": \"cripto-{{$randomUUID}}\",\n  \"amount\": 1000.00,\n  \"cryptoType\": \"USDT\",\n  \"walletAddress\": \"0x742d35Cc6634C0532925a3b8D4C9db96DfB3f681\",\n  \"fiatCurrency\": \"BRL\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/cripto",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "cripto"]
            }
          }
        }
      ]
    },
    {
      "name": "BalanceService",
      "item": [
        {
          "name": "Consultar Saldo",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/saldos/clientes/{{$randomUUID}}",
              "host": ["{{base_url}}"],
              "path": ["saldos", "clientes", "{{$randomUUID}}"]
            }
          }
        }
      ]
    },
    {
      "name": "WebhookService",
      "item": [
        {
          "name": "Registrar Webhook",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"url\": \"https://webhook.site/unique-id\",\n  \"events\": [\"PIX_CONFIRMED\", \"BOLETO_PAID\", \"TED_CONFIRMED\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks",
              "host": ["{{base_url}}"],
              "path": ["webhooks"]
            }
          }
        },
        {
          "name": "Webhook Incoming (Simulação)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"PIX_CONFIRMED\",\n  \"transactionId\": \"{{$randomUUID}}\",\n  \"endToEndId\": \"E12345678202509161234567890\",\n  \"status\": \"CONFIRMED\",\n  \"amount\": 100.50,\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/webhooks/incoming",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "incoming"]
            }
          }
        }
      ]
    },
    {
      "name": "Admin APIs",
      "item": [
        {
          "name": "Criar Usuário",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{$randomUUID}}\",\n  \"email\": \"usuario@exemplo.com\",\n  \"role\": \"cliente\",\n  \"accountId\": \"{{$randomUUID}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/users",
              "host": ["{{base_url}}"],
              "path": ["users"]
            }
          }
        },
        {
          "name": "Configurar Taxa",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bankCode\": \"341\",\n  \"taxa\": 1.99,\n  \"type\": \"PIX\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/config/taxas",
              "host": ["{{base_url}}"],
              "path": ["config", "taxas"]
            }
          }
        },
        {
          "name": "Listar Taxas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/config/taxas",
              "host": ["{{base_url}}"],
              "path": ["config", "taxas"]
            }
          }
        }
      ]
    },
    {
      "name": "QR Code PIX",
      "item": [
        {
          "name": "Gerar QR Code Estático",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code estático gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.qrcodePayload).to.not.be.empty;",
                  "    pm.expect(response.qrcodeImage).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('static');",
                  "    pm.expect(response.expiresAt).to.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"chave\": \"user@example.com\",\n  \"descricao\": \"QR Code estático para pagamentos\",\n  \"cidade\": \"São Paulo\",\n  \"nomeRecebedor\": \"João Silva\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix/qrcode/estatico",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix", "qrcode", "estatico"]
            }
          }
        },
        {
          "name": "Gerar QR Code Dinâmico",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code dinâmico gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.qrcodePayload).to.not.be.empty;",
                  "    pm.expect(response.qrcodeImage).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('dynamic');",
                  "    pm.expect(response.amount).to.be.a('number');",
                  "    pm.expect(response.expiresAt).to.not.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"chave\": \"user@example.com\",\n  \"valor\": 100.50,\n  \"descricao\": \"Pagamento de teste\",\n  \"cidade\": \"São Paulo\",\n  \"nomeRecebedor\": \"João Silva\",\n  \"expiracaoMinutos\": 30\n}"
            },
            "url": {
              "raw": "{{base_url}}/transacoes/pix/qrcode/dinamico",
              "host": ["{{base_url}}"],
              "path": ["transacoes", "pix", "qrcode", "dinamico"]
            }
          }
        },
        {
          "name": "Gerar QR Code Estático (Banking)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('QR Code estático banking gerado com sucesso', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.transactionId).to.not.be.empty;",
                  "    pm.expect(response.type).to.eql('static');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"chave\": \"12345678901\",\n  \"descricao\": \"QR Code para internet banking\",\n  \"cidade\": \"São Paulo\",\n  \"nomeRecebedor\": \"Banco Exemplo\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/banking/transacoes/pix/qrcode/estatico",
              "host": ["{{base_url}}"],
              "path": ["banking", "transacoes", "pix", "qrcode", "estatico"]
            }
          }
        },
        {
          "name": "Health Check QR Code",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/qrcode/health",
              "host": ["{{base_url}}"],
              "path": ["qrcode", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "IntegrationService - Routing",
      "item": [
        {
          "name": "Selecionar Conta para Transação (Roteamento Ponderado)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"bankCode\": \"STARK\",\n  \"amount\": 1000.00\n}"
            },
            "url": {
              "raw": "{{base_url}}/integrations/routing/select-account",
              "host": ["{{base_url}}"],
              "path": ["integrations", "routing", "select-account"]
            }
          }
        },
        {
          "name": "Listar Contas com Prioridades",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/integrations/routing/accounts-priority",
              "host": ["{{base_url}}"],
              "path": ["integrations", "routing", "accounts-priority"]
            }
          }
        },
        {
          "name": "Health Check Integrations",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/integrations/health",
              "host": ["{{base_url}}"],
              "path": ["integrations", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "Acessos RBAC",
      "item": [
        {
          "name": "Banking - Criar Sub-usuário",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subUserEmail\": \"subuser@cliente.com\",\n  \"role\": \"sub-cliente\",\n  \"permissions\": [\n    \"view_dashboard\",\n    \"view_transacoes\",\n    \"view_contas\",\n    \"view_extratos\"\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/acessos/banking",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "banking"]
            }
          }
        },
        {
          "name": "Banking - Listar Meus Sub-usuários",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/acessos/banking",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "banking"]
            }
          }
        },
        {
          "name": "Admin - Criar Acesso de Usuário",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"33333333-3333-3333-3333-333333333333\",\n  \"role\": \"sub-admin\",\n  \"permissions\": [\n    \"view_dashboard\",\n    \"view_transacoes\",\n    \"view_contas\",\n    \"view_clientes\",\n    \"view_relatorios\",\n    \"view_extratos\"\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/acessos/admin",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "admin"]
            }
          }
        },
        {
          "name": "Admin - Listar Todos os Acessos",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/acessos/admin?role=cliente&isActive=true&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "admin"],
              "query": [
                {
                  "key": "role",
                  "value": "cliente"
                },
                {
                  "key": "isActive",
                  "value": "true"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "Validar Permissão",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"22222222-2222-2222-2222-222222222222\",\n  \"permission\": \"view_dashboard\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/acessos/validate-permission",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "validate-permission"]
            }
          }
        },
        {
          "name": "Obter Permissões Disponíveis",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/acessos/permissions",
              "host": ["{{base_url}}"],
              "path": ["api", "acessos", "permissions"]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "acesso_id",
      "value": "00000000-0000-0000-0000-000000000000",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "22222222-2222-2222-2222-222222222222",
      "type": "string"
    },
    {
      "key": "banking_token",
      "value": "",
      "type": "string"
    }
  ]
}
